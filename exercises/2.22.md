## Exercise 2.22

Louis Reasoner tries to rewrite the first `square-list` procedure of [Exercise 2.21](./2.21.md) so that it evolves an iterative process:

```scheme
(define (square-list items)
  (define (iter things answer)
    (if (null? things)
        answer
        (iter (cdr things)
              (cons (square (car things))
                    answer))))
  (iter items nil))
```

Unfortunately, defining `square-list` this way produces the answer list in the reverse order of the one desired. Why?

Louis then tries to fix his bug by interchanging the arguments to `cons`:

```scheme
(define (square-list items)
  (define (iter things answer)
    (if (null? things)
        answer
        (iter (cdr things)
              (cons answer
                    (square
                     (car things))))))
  (iter items nil))
```

This doesnâ€™t work either. Explain.

## Solution

### First attempt

The first attempt correctly accumulates squares but reverses the list because `cons` prepends, resulting in reversed order.

We can check this using the `trace` helper:

```scheme
(define (square-list items)
  (define (iter things answer)
    (if (null? things)
        answer
        (iter (cdr things)
              (cons (square (car things))
                    answer))))
  (trace iter)
  (iter items '()))

(square-list (list 1 2 3 4))
```

```scheme
>(iter '(1 2 3 4) '())
>(iter '(2 3 4) '(1))
>(iter '(3 4) '(4 1))
>(iter '(4) '(9 4 1))
>(iter '() '(16 9 4 1))
<'(16 9 4 1)
'(16 9 4 1)
```

### Second attempt

The second attempt mistakenly swaps `cons` arguments, making the first argument `answer` (a list), and the second a number, which violates `cons` contract â€” the second argument must be a list. Hence it builds a deeply nested improper list (a pair with a list as `car` and a number as `cdr`), resulting in an unreadable structure.

- `cons` expects its second argument to be a proper list (either `'()` or a pair whose `cdr` is again a proper list)
- When you do `(cons answer (square (car things)))`, `answer` is a list, but `(square (car things))` is a number â€” a non-list â€” so this creates an improper list (a dotted pair).

We can check using the `trace` helper:

```scheme
(define (square-list items)
  (define (iter things answer)
    (if (null? things)
        answer
        (iter (cdr things)
              (cons answer
                    (square
                     (car things))))))
  (trace iter)
  (iter items '()))

(square-list (list 1 2 3 4))
```

```scheme
>(iter '(1 2 3 4) '())
>(iter '(2 3 4) '(() . 1))
>(iter '(3 4) '((() . 1) . 4))
>(iter '(4) '(((() . 1) . 4) . 9))
>(iter '() '((((() . 1) . 4) . 9) . 16))
<'((((() . 1) . 4) . 9) . 16)
'((((() . 1) . 4) . 9) . 16)
```
